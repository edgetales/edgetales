<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, interactive-widget=resizes-content">
<link rel="apple-touch-icon" href="/apple-touch-icon.png">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="EdgeTales">
<style>
:root {
    --bg-primary: #121212;
    --bg-sidebar: #171717;
    --bg-surface: #2a2a2a;
    --bg-surface-light: #333;
    --accent: #D97706;
    --accent-light: #F59E0B;
    --accent-dim: rgba(217,119,6,0.15);
    --text-primary: #e5e5e5;
    --text-secondary: #a3a3a3;
    --border: #3a3a3a;
    --border-light: #444;
    /* Safe area insets for notch/Dynamic Island devices */
    --sat: env(safe-area-inset-top, 0px);
    --sab: env(safe-area-inset-bottom, 0px);
    --sal: env(safe-area-inset-left, 0px);
    --sar: env(safe-area-inset-right, 0px);
}
/* --- Scrollbars: hidden by default, subtle on hover --- */
.q-drawer__content, .chat-scroll {
    scrollbar-width: thin;
    scrollbar-color: transparent transparent;
    overflow-y: auto;
}
.q-drawer__content:hover, .chat-scroll:hover {
    scrollbar-color: rgba(255,255,255,0.12) transparent;
}
.q-drawer__content::-webkit-scrollbar, .chat-scroll::-webkit-scrollbar { width: 5px; }
.q-drawer__content::-webkit-scrollbar-track, .chat-scroll::-webkit-scrollbar-track { background: transparent; }
.q-drawer__content::-webkit-scrollbar-thumb, .chat-scroll::-webkit-scrollbar-thumb { background: transparent; border-radius: 3px; }
.q-drawer__content:hover::-webkit-scrollbar-thumb, .chat-scroll:hover::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.12); }
.q-drawer__content:hover::-webkit-scrollbar-thumb:hover, .chat-scroll:hover::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.22); }
/* --- Global overrides --- */
.q-drawer { background: var(--bg-sidebar) !important; border-right: 1px solid var(--border) !important; }
.q-page { background: var(--bg-primary) !important; }
body { background: var(--bg-primary) !important; }
/* Prevent horizontal overflow on mobile */
html, body, .q-page { max-width: 100vw; overflow-x: hidden; }
/* Prevent iOS Safari auto-zoom on input focus (triggers at font-size < 16px) */
input, textarea, select, .q-field__native, .q-field__input { font-size: 16px !important; }
/* --- Sidebar expansions: subtle, no fill --- */
.q-expansion-item .q-item { padding: 8px 12px; border-radius: 8px; min-height: 44px; }
.q-expansion-item .q-item:hover { background: var(--accent-dim); }
.q-expansion-item .q-item__label { color: var(--text-primary); font-size: 0.9rem; padding-left: 1.8em; text-indent: -1.8em; }
.q-separator { background: var(--border) !important; }
/* --- Layout --- */
.chat-scroll { padding: 1rem; padding-bottom: 5rem; flex: 1; }
.choice-grid { display: grid; grid-template-columns: repeat(2, minmax(0, 1fr)); gap: 0.5rem; width: 100%; }
@media (min-width: 768px) { .choice-grid { grid-template-columns: repeat(4, minmax(0, 1fr)); } }
/* --- Choice buttons: subtle outline, min touch target --- */
.choice-btn.q-btn { border: 1px solid var(--border-light) !important; color: var(--text-primary) !important;
              background: transparent !important; text-transform: none !important; font-weight: 400 !important;
              letter-spacing: normal !important; min-height: 48px; min-width: 0; overflow: hidden; }
.choice-btn.q-btn .q-btn__content { color: var(--text-primary) !important; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; min-width: 0; }
.choice-btn.q-btn:hover { border-color: var(--accent) !important; background: var(--accent-dim) !important; }
/* --- Chat messages --- */
.chat-msg { margin-bottom: 0.25rem; padding: 0.4rem 0; color: var(--text-primary); }
.chat-msg.assistant { background: transparent; border: none; }
.chat-msg.user { background: var(--bg-surface); border-left: 3px solid #C45C3A; border-radius: 12px; padding: 0.5rem 1rem; }
.chat-msg.recap { background: transparent; border: none; border-top: 1px solid var(--border); padding-top: 1rem; }
.chat-msg h1, .chat-msg h2, .chat-msg h3 { font-size: 1.1rem !important; font-weight: 600; margin: 0.5em 0 0.3em 0; }
.scene-marker { text-align: center; color: var(--text-secondary); font-size: 0.85em; margin: 0.5em 0;
                 padding: 0.3em 0; }
/* --- Stat grid --- */
.stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 0.5rem; }
.stat-item { padding: 0.4rem 0.6rem; background: transparent; border-radius: 8px; text-align: center; }
.stat-value { font-size: 1.8rem; font-weight: 700; line-height: 1.2; color: var(--text-primary); }
.stat-label { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.1rem; }
/* --- Track bars --- */
.track-bar { height: 8px; border-radius: 4px; background: var(--bg-surface-light); overflow: hidden; margin: 2px 0 8px; }
.track-fill { height: 100%; border-radius: 4px; transition: width 0.3s; }
.track-fill.health { background: linear-gradient(90deg, #dc2626, #ef4444); }
.track-fill.spirit { background: linear-gradient(90deg, #2563eb, #60a5fa); }
.track-fill.supply { background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
.track-fill.chaos { background: linear-gradient(90deg, #737373, #dc2626); }
.track-fill.progress { background: linear-gradient(90deg, var(--accent), var(--accent-light)); }
/* --- Dice display --- */
.dice-simple { text-align: right; font-size: 0.8em; opacity: 0.8; margin-top: 0.5em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
/* --- Audio player (ui.audio) dark mode â€” scoped to chat area --- */
.chat-scroll audio, .chat-msg audio { filter: invert(1) hue-rotate(180deg); opacity: 0.85; width: 100%; min-height: 40px; border-radius: 8px; }
.dice-simple.success { color: #4ade80; } .dice-simple.warning { color: var(--accent-light); } .dice-simple.error { color: #f87171; }
/* --- STT mic recording pulse --- */
.stt-mic-btn.bg-red { animation: stt-pulse 1.2s infinite; }
@keyframes stt-pulse { 0%,100% { box-shadow: 0 0 0 0 rgba(220,38,38,0.5); } 50% { box-shadow: 0 0 0 8px rgba(220,38,38,0); } }
/* --- STT status line (inline below input) --- */
.stt-status-row { padding: 0.15rem 1rem 0.3rem; font-size: 0.8rem; color: var(--text-secondary);
                   min-height: 0; transition: opacity 0.3s ease; }
.stt-status-row.hidden { opacity: 0; height: 0; padding: 0; overflow: hidden; }
/* --- STT waveform visualizer --- */
.stt-waveform { display: inline-flex; align-items: center; gap: 2px; height: 18px; vertical-align: middle; margin-right: 6px; }
.stt-waveform .wv-bar { width: 3px; border-radius: 1.5px; background: #ef4444; animation: stt-wave 0.6s ease-in-out infinite; }
.stt-waveform .wv-bar:nth-child(1) { height: 6px; animation-delay: 0.0s; }
.stt-waveform .wv-bar:nth-child(2) { height: 12px; animation-delay: 0.1s; }
.stt-waveform .wv-bar:nth-child(3) { height: 8px; animation-delay: 0.2s; }
.stt-waveform .wv-bar:nth-child(4) { height: 16px; animation-delay: 0.15s; }
.stt-waveform .wv-bar:nth-child(5) { height: 10px; animation-delay: 0.25s; }
.stt-waveform .wv-bar:nth-child(6) { height: 14px; animation-delay: 0.05s; }
.stt-waveform .wv-bar:nth-child(7) { height: 7px; animation-delay: 0.3s; }
@keyframes stt-wave { 0%,100% { transform: scaleY(0.3); opacity: 0.6; } 50% { transform: scaleY(1.0); opacity: 1.0; } }
/* --- STT transcribing spinner --- */
.stt-spinner-inline { display: inline-block; width: 14px; height: 14px; border: 2px solid var(--text-secondary);
                       border-top-color: var(--accent); border-radius: 50%; animation: stt-spin 0.8s linear infinite;
                       vertical-align: middle; margin-right: 6px; }
@keyframes stt-spin { to { transform: rotate(360deg); } }
/* --- Footer: safe area padding for notch devices --- */
.q-footer { padding-bottom: var(--sab) !important; }
/* --- Slim header bar: transparent, minimal, safe area aware --- */
.rpg-slim-header.q-header { background: rgba(18,18,18,0.85) !important; backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px);
                box-shadow: none !important; border-bottom: 1px solid var(--border) !important;
                min-height: 48px !important; padding-top: var(--sat) !important;
                padding-left: var(--sal) !important; padding-right: var(--sar) !important; }
/* ==========================================
   MOBILE RESPONSIVE (max-width: 768px)
   ========================================== */
@media (max-width: 768px) {
    /* --- Chat messages: tighter padding on small screens --- */
    .chat-msg.user { padding: 0.5rem 0.75rem; }
    /* --- Stat grid: smaller values, keep readable --- */
    .stat-value { font-size: 1.4rem; }
    .stat-label { font-size: 0.75rem; }
    .stat-item { padding: 0.35rem 0.5rem; }
    /* --- Chat scroll: less horizontal padding --- */
    .chat-scroll { padding: 0.5rem; padding-bottom: 5rem; }
    /* --- Scene markers: slightly smaller --- */
    .scene-marker { font-size: 0.8em; }
    /* --- Footer input bar: tighter on mobile --- */
    .rpg-input-bar { padding-left: 0.5rem !important; padding-right: 0.5rem !important; }
    /* --- Sidebar: slightly narrower on very small screens handled by Quasar breakpoint --- */
    .q-drawer__content { padding: 0.5rem; }
    /* --- Expansion items in sidebar: ensure touch targets --- */
    .q-expansion-item .q-item { min-height: 48px; display: flex; align-items: center; }
    /* --- Momentum/GameOver cards: full-width padding (only in main content, not sidebar) --- */
    .q-page > .q-card, .chat-scroll .q-card { margin: 0 !important; }
    /* --- Draft selector buttons: allow wrapping --- */
    .q-btn { min-height: 44px; }
}
/* ==========================================
   SMALL MOBILE (max-width: 400px)
   ========================================== */
@media (max-width: 400px) {
    /* --- Even tighter for iPhone SE / small Android --- */
    .stat-value { font-size: 1.2rem; }
    .stat-grid { gap: 0.35rem; }
    .choice-grid { gap: 0.35rem; }
    .choice-btn.q-btn { font-size: 0.8rem; min-height: 44px; padding: 0.4rem 0.5rem; }
    .chat-msg.user { padding: 0.4rem 0.6rem; border-radius: 8px; }
    .chat-scroll { padding: 0.35rem; padding-bottom: 5rem; }
}
</style>
